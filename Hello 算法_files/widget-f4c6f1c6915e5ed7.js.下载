(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7110],{4469:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/widget",function(){return n(9705)}])},9705:function(e,t,n){"use strict";n.r(t),n.d(t,{__N_SSP:function(){return E},default:function(){return L}});var o=n(8450),s=n(8624),r=n.n(s),i=n(3205),a=n(5917),c=n(367),d=n(6753),l=n(1147),u=n(54),m=n(4761);class p extends Error{constructor(e,t,n){super(e),this.status=t,this.data=n}}async function h(e){let[t,n]=e;const o=await fetch(t,n),s=await o.json();if(!o.ok)throw new p(s?.error||o.statusText,o.status,s);return s}function g(e){return Object.entries(e).reduce(((e,t)=>{let[n,o]=t;return(0,m.xb)(o)?e:{...e,[n]:o}}),{})}var b=n(8762),y=n(2646);function f(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const{0:s,1:r}=(0,i.useState)(0),a=new URLSearchParams(g({...e,...n})),c=(0,i.useMemo)((()=>({headers:t?{Authorization:`Bearer ${t}`}:{}})),[t]),d=(t,o)=>{if(0===n.first||0===n.last)return null;if(0===t)return[`/api/discussions?${a}`,c];if(!o.discussion.pageInfo.hasNextPage)return null;return[`/api/discussions?${new URLSearchParams(g({...e,after:o.discussion.pageInfo.endCursor,before:n.before}))}`,c]},m=e=>![403,404,429].includes(e),{data:p,size:b,setSize:f,error:C,mutate:v,isValidating:N}=(0,u.ZP)(d,h,{onErrorRetry:(e,t,n,o,s)=>{m(e?.status)&&l.J$.defaultValue.onErrorRetry(e,t,n,o,s)},revalidateFirstPage:o||y.E.revalidate_first_page,revalidateOnMount:m(s),revalidateOnFocus:m(s),revalidateOnReconnect:m(s)});C?.status&&C.status!==s?r(C.status):!C?.status&&s&&r(0);const w=(0,i.useCallback)((e=>{if(!p)return v();const t=p.slice(0,p.length-1),[n]=p.slice(-1);return v([...t,{...n,discussion:{...n.discussion,comments:[...n.discussion?.comments||[],e]}}],!1),v()}),[p,v]),x=(0,i.useCallback)((e=>{const t=p.map((t=>({...t,discussion:{...t.discussion,comments:t.discussion.comments.map((t=>t.id===e.replyToId?{...t,replies:[...t.replies,e]}:t))}})));return v(t,!1),v()}),[p,v]),k=(0,i.useCallback)(((e,t)=>v(e,!t)&&t?.then((()=>v()))),[v]),Z=(0,i.useCallback)(((e,t)=>v(p.map((t=>({...t,discussion:{...t.discussion,comments:t.discussion.comments.map((t=>t.id===e.id?e:t))}}))),!t)&&t?.then((()=>v()))),[p,v]),S=(0,i.useCallback)(((e,t)=>v(p.map((t=>({...t,discussion:{...t.discussion,comments:t.discussion.comments.map((t=>t.id===e.replyToId?{...t,replies:t.replies.map((t=>t.id===e.id?e:t))}:t))}}))),!t)&&t?.then((()=>v()))),[p,v]);return{data:p,error:C,size:b,setSize:f,isValidating:N,isLoading:!C&&!p,isError:!!C,mutators:{addNewComment:w,addNewReply:x,updateDiscussion:k,updateComment:Z,updateReply:S,mutate:v}}}var C=n(5391),v=n(6105),N=n(6873),w=n(3494);function x(e){let{discussionId:t,context:n,replyToId:s,className:r="",onSubmit:d,onDiscussionCreateRequest:l}=e;const{t:u}=(0,c.$I)(),{0:p,1:h}=(0,i.useState)(!1),{0:g,1:b}=(0,i.useState)(""),{0:y,1:f}=(0,i.useState)(""),{0:C,1:x}=(0,i.useState)(""),{0:k,1:Z}=(0,i.useState)(!1),{0:S,1:I}=(0,i.useState)(!1),{0:R,1:E}=(0,i.useState)(!1),{0:L,1:B}=(0,i.useState)(!1),{0:T,1:_}=(0,i.useState)(""),{token:A,origin:P,getLoginUrl:O,onSignOut:$}=(0,i.useContext)(a.Vo),D=(0,i.useRef)(null),M=O(P),X=!!s,z=u(X?"writeAReply":"writeAComment");(0,i.useEffect)((()=>{p&&g!==y&&(g&&(Z(!0),async function(e,t,n){return fetch(w.Db,{method:"POST",headers:t?{Authorization:`token ${t}`}:{},body:JSON.stringify({mode:"gfm",text:e,...n?{context:n}:{}})}).then((e=>e.text()))}(g,A,n).then((e=>{const t=(0,N.jd)(e);x(t),Z(!1)}))),f(g))}),[p,g,y,A,n]);const H=(0,i.useCallback)((()=>{b(""),x(""),h(!1),I(!1),E(!1)}),[]),j=(0,i.useCallback)((async()=>{if(S||!t&&!l)return;I(!0);const e=t||await l(),n={body:g,discussionId:e,replyToId:s};s?async function(e,t){return fetch(w.Lp,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({query:"\n  mutation($body: String!, $discussionId: ID!, $replyToId: ID!) {\n    addDiscussionReply: addDiscussionComment(input: {body: $body, discussionId: $discussionId, replyToId: $replyToId}) {\n      reply: comment {\n        id\n        author {\n          avatarUrl\n          login\n          url\n        }\n        viewerDidAuthor\n        createdAt\n        url\n        authorAssociation\n        lastEditedAt\n        deletedAt\n        isMinimized\n        bodyHTML\n        reactionGroups {\n          content\n          users {\n            totalCount\n          }\n          viewerHasReacted\n        }\n        replyTo {\n          id\n        }\n      }\n    }\n  }",variables:e})}).then((e=>e.json()))}(n,A).then((e=>{let{data:{addDiscussionReply:t}}=e;const{reply:n}=t,o=(0,N.KF)(n);d(o),H()})):async function(e,t){return fetch(w.Lp,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({query:"\n  mutation($body: String!, $discussionId: ID!) {\n    addDiscussionComment(input: {body: $body, discussionId: $discussionId}) {\n      comment {\n        id\n        upvoteCount\n        viewerHasUpvoted\n        viewerCanUpvote\n        author {\n          avatarUrl\n          login\n          url\n        }\n        viewerDidAuthor\n        createdAt\n        url\n        authorAssociation\n        lastEditedAt\n        deletedAt\n        isMinimized\n        bodyHTML\n        reactionGroups {\n          content\n          users {\n            totalCount\n          }\n          viewerHasReacted\n        }\n        replies(first: 100) {\n          totalCount\n          nodes {\n            id\n            author {\n              avatarUrl\n              login\n              url\n            }\n            createdAt\n            url\n            authorAssociation\n            lastEditedAt\n            deletedAt\n            isMinimized\n            bodyHTML\n            reactionGroups {\n              content\n              users {\n                totalCount\n              }\n              viewerHasReacted\n            }\n          }\n        }\n      }\n    }\n  }",variables:e})}).then((e=>e.json()))}(n,A).then((e=>{let{data:{addDiscussionComment:t}}=e;const{comment:n}=t,o=(0,N.qw)(n);d(o),H()}))}),[S,t,g,s,l,A,d,H]),U=(0,i.useCallback)((e=>{b(e.target.value),T&&T!==D.current.style.height||((0,m.p1)(D.current),_(D.current.style.height))}),[T]);return(0,i.useEffect)((()=>{D.current&&R&&D.current.focus()}),[R]),!X||R?(0,o.BX)("form",{className:`color-bg-primary color-border-primary gsc-comment-box ${X?"gsc-comment-box-is-reply":""} ${r}`,onSubmit:e=>{e.preventDefault(),j()},children:[(0,o.BX)("div",{className:"color-bg-tertiary color-border-primary gsc-comment-box-tabs",children:[(0,o.BX)("div",{className:"mx-2 mb-[-1px] mt-2",children:[(0,o.tZ)("button",{className:"rounded-t border border-b-0 px-4 py-2 "+(p?"color-text-secondary border-transparent":"color-text-primary color-bg-canvas color-border-primary"),onClick:()=>h(!1),type:"button",children:u("write")}),(0,o.tZ)("button",{className:"ml-1 rounded-t border border-b-0 px-4 py-2 "+(p?"color-text-primary color-bg-canvas color-border-primary":"color-text-secondary border-transparent"),onClick:()=>h(!0),type:"button",children:u("preview")})]}),p?null:(0,o.tZ)("div",{className:"gsc-comment-box-md-toolbar",children:(0,o.tZ)("button",{className:"gsc-toolbar-item",type:"button",title:u(L?"disableFixedWidth":"enableFixedWidth"),onClick:()=>{B(!L),D.current.focus()},tabIndex:-1,children:(0,o.tZ)(v.R1h,{})})})]}),(0,o.tZ)("div",{className:"gsc-comment-box-main",children:p?(0,o.tZ)("div",{className:"markdown color-border-primary gsc-comment-box-preview",dangerouslySetInnerHTML:k?void 0:{__html:C||u("nothingToPreview")},onClick:N.Cn,children:k?u("loadingPreview"):void 0}):(0,o.BX)("div",{className:"gsc-comment-box-write",children:[(0,o.tZ)("textarea",{className:"form-control input-contrast gsc-comment-box-textarea "+(L?"gsc-is-fixed-width":""),placeholder:A?z:u("signInToComment"),onChange:U,value:g,disabled:!A||S,ref:D,onKeyDown:e=>(e.ctrlKey||e.metaKey)&&"Enter"===e.key&&j()}),(0,o.tZ)("div",{className:"form-control input-contrast gsc-comment-box-textarea-extras",children:(0,o.tZ)("a",{className:"link-secondary gsc-comment-box-markdown-hint flex gap-2",rel:"nofollow noopener noreferrer",target:"_blank",href:"https://guides.github.com/features/mastering-markdown/",title:u("stylingWithMarkdownIsSupported"),children:(0,o.tZ)(v.BuP,{className:"mr-1"})})})]})}),(0,o.BX)("div",{className:"gsc-comment-box-bottom",children:[A&&!X?(0,o.BX)("button",{type:"button",className:"link-secondary text-sm",onClick:$,children:[(0,o.tZ)(v.E2Z,{className:"mr-2"}),u("signOut")]}):null,(0,o.BX)("div",{className:"gsc-comment-box-buttons",children:[X?(0,o.tZ)("button",{className:"btn ml-1 rounded-md border",onClick:()=>E(!1),type:"button",children:u("cancel")}):null,A?(0,o.tZ)("button",{className:"btn btn-primary items-center ml-1 rounded-md border",type:"submit",disabled:A&&!g.trim()||S,children:u(X?"reply":"comment")}):(0,o.BX)("a",{className:"btn btn-primary inline-flex items-center ml-1 rounded-md border hover:no-underline",target:"_top",href:M,children:[(0,o.tZ)(v.g_Y,{className:"mr-2",fill:"currentColor"})," ",u("signInWithGitHub")]})]})]})]}):(0,o.tZ)("div",{className:"color-bg-tertiary gsc-reply-box",children:(0,o.tZ)("button",{className:"form-control color-text-secondary color-border-primary w-full cursor-text rounded border px-2 py-1 text-left focus:border-transparent",onClick:()=>{E(!0)},type:"button",children:u("writeAReply")})})}var k=n(4457);function Z(e){let{onDiscussionCreateRequest:t,onError:s}=e;const{token:r,origin:l}=(0,i.useContext)(a.Vo),{t:u}=(0,c.$I)(),{repo:m,term:p,number:h,category:g,strict:y,reactionsEnabled:v,emitMetadata:N,inputPosition:w,defaultCommentOrder:Z}=(0,i.useContext)(a.E_),{0:S,1:I}=(0,i.useState)(Z),R={repo:m,term:p,category:g,number:h,strict:y},{addNewComment:E,updateReactions:L,increaseSize:B,backMutators:T,frontMutators:_,...A}=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"oldest";const o=f(e,t,{last:15},!0),{data:s,isLoading:r,mutators:a,error:c}=o,d=s&&s[s.length-1],l=d?.discussion?.comments?.[0]?.id,u=f(e,t,{first:15}),{data:m,isLoading:p,size:h,setSize:g,error:y}=u,C=m?.map((e=>{let t=!1;const n={...e,discussion:{...e?.discussion,comments:e?.discussion?.comments?.filter((e=>(e.id===l&&(t=!0),!t)))}};return n.discussion.totalReplyCount=n.discussion.comments?.reduce(((e,t)=>e+t.replyCount),0),n}));let v=d?.discussion?.comments||[],N=C?.flatMap((e=>e?.discussion?.comments||[]))||[],w=o.mutators,x=u.mutators;if("newest"===n){const e=N;N=v.slice().reverse(),v=e.slice().reverse(),x=o.mutators,w=u.mutators}const k=a.addNewComment,Z=(0,i.useCallback)(((e,t)=>d?a.updateDiscussion([(0,b.aT)(d,e)],t):t.then((()=>a.mutate()))),[d,a]),S=(0,i.useCallback)((()=>g(h+1)),[g,h]),I=d?.discussion?.totalCommentCount-d?.discussion?.comments?.length-C?.reduce(((e,t)=>e+t.discussion.comments?.length),0),R=d?.discussion?.reactionCount,E=d?.discussion?.totalCommentCount,L=(d?.discussion?.totalReplyCount||0)+(C?.reduce(((e,t)=>e+t.discussion.totalReplyCount),0)||0),B=y||c,T=d?.discussion?.pageInfo?.hasPreviousPage,_=T&&p||r,A=p||h>0&&!C?.[h-1],P=404===B?.status,O=429===B?.status,$=d?.discussion?.locked,D={id:d?.discussion?.id,url:d?.discussion?.url,locked:d?.discussion?.locked,reactions:d?.discussion?.reactions,repository:d?.discussion?.repository,reactionCount:R,totalCommentCount:E,totalReplyCount:L},M=d?.viewer;return{addNewComment:k,updateReactions:Z,increaseSize:S,frontData:C,frontComments:N,frontMutators:x,backData:d,backComments:v,backMutators:w,numHidden:I,reactionCount:R,totalCommentCount:E,totalReplyCount:L,error:B,isLoading:_,isLoadingMore:A,isNotFound:P,isRateLimited:O,isLocked:$,discussion:D,viewer:M}}(R,r,S);(0,i.useEffect)((()=>{A.error&&s&&s(A.error?.message)}),[A.error,s]),(0,i.useEffect)((()=>{if(!N||!A.discussion.id)return;const e={discussion:A.discussion,viewer:A.viewer};(0,d.A)(e,l)}),[A.discussion,A.viewer,N,l]),(0,i.useEffect)((()=>{n.e(1907).then(n.bind(n,1907))}),[]);const P=async()=>{const e=await t();return _.mutate(),T.mutate(),e},O=(0,o.tZ)(x,{discussionId:A.discussion.id,context:m,onSubmit:E,onDiscussionCreateRequest:P}),$=A.isNotFound&&!h,D=!!A.discussion.url,M=!A.error&&!A.isNotFound&&!A.isLoading&&A.totalReplyCount>0,X=A.isRateLimited&&!r||!A.isLoading&&!A.isLocked&&(!A.error||A.isNotFound&&!h);return A.isLoading?(0,o.BX)("div",{className:"gsc-loading",children:[(0,o.tZ)("div",{className:"gsc-loading-image"}),(0,o.tZ)("span",{className:"gsc-loading-text color-fg-muted",children:u("loadingComments")})]}):(0,o.BX)("div",{className:"color-text-primary gsc-main",children:[!v||A.isLoading||!$&&A.error?null:(0,o.BX)("div",{className:"gsc-reactions",children:[(0,o.tZ)("h4",{className:"gsc-reactions-count",children:$&&!A.reactionCount?u("reactions",{count:0}):(0,o.tZ)("a",{href:A.discussion.url,target:"_blank",rel:"noreferrer noopener nofollow",className:"color-text-primary",children:u("reactions",{count:A.reactionCount||0})})}),(0,o.tZ)("div",{className:"flex flex-auto items-center justify-center gap-2 text-sm mt-2",children:(0,o.tZ)(k.Z,{subjectId:A.discussion.id,reactionGroups:A.discussion.reactions,onReact:L,onDiscussionCreateRequest:P})})]}),(0,o.BX)("div",{className:"gsc-comments",children:[(0,o.BX)("div",{className:"gsc-header",children:[(0,o.BX)("div",{className:"gsc-left-header",children:[(0,o.tZ)("h4",{className:"gsc-comments-count",children:$&&!A.totalCommentCount?u("comments",{count:0}):A.error&&!A.backData?u("genericError",{message:A.error?.message||""}):(0,o.tZ)("a",{href:A.discussion.url,target:"_blank",rel:"noreferrer noopener nofollow",className:"color-text-primary",children:u("comments",{count:A.totalCommentCount})})}),M?(0,o.BX)(o.HY,{children:[(0,o.tZ)("h4",{className:"gsc-comments-count-separator",children:"\xb7"}),(0,o.tZ)("h4",{className:"gsc-replies-count",children:u("replies",{count:A.totalReplyCount,plus:A.numHidden>0?"+":""})})]}):null,D?(0,o.tZ)("em",{className:"color-text-secondary text-sm",children:(0,o.tZ)(c.cC,{i18nKey:"common:poweredBy",components:{a:(0,o.tZ)("a",{href:"https://giscus.app",target:"_blank",rel:"noreferrer noopener nofollow",className:"link-secondary"})}})}):null]}),A.totalCommentCount>0?(0,o.BX)("ul",{className:"gsc-right-header BtnGroup",children:[(0,o.tZ)("li",{className:"BtnGroup-item "+("oldest"===S?"BtnGroup-item--selected":""),"aria-current":"oldest"===S,children:(0,o.tZ)("button",{className:"btn",onClick:()=>I("oldest"),children:u("oldest")})}),(0,o.tZ)("li",{className:"BtnGroup-item "+("newest"===S?"BtnGroup-item--selected":""),"aria-current":"newest"===S,children:(0,o.tZ)("button",{className:"btn",onClick:()=>I("newest"),children:u("newest")})})]}):null]}),X&&"top"===w?O:null,(0,o.BX)("div",{className:"gsc-timeline "+(A.totalCommentCount?"":"hidden"),children:[A.isLoading?null:A.frontComments.map((e=>(0,o.tZ)(C.Z,{comment:e,replyBox:r&&!A.isLocked?(0,o.tZ)(x,{discussionId:A.discussion.id,context:m,onSubmit:_.addNewReply,replyToId:e.id}):void 0,onCommentUpdate:_.updateComment,onReplyUpdate:_.updateReply},e.id))),A.numHidden>0?(0,o.tZ)("div",{className:"pagination-loader-container gsc-pagination",children:(0,o.BX)("button",{className:"gsc-pagination-button color-border-primary",onClick:B,disabled:A.isLoadingMore,children:[(0,o.tZ)("span",{className:"color-text-secondary",children:u("hiddenItems",{count:A.numHidden})}),(0,o.BX)("span",{className:"color-text-link font-semibold",children:[A.isLoadingMore?u("loading"):u("loadMore"),"\u2026"]})]})}):null,A.isLoading?null:A.backComments.map((e=>(0,o.tZ)(C.Z,{comment:e,replyBox:r&&!A.isLocked?(0,o.tZ)(x,{discussionId:A.discussion.id,context:m,onSubmit:T.addNewReply,replyToId:e.id}):void 0,onCommentUpdate:T.updateComment,onReplyUpdate:T.updateReply},e.id)))]}),X&&"top"!==w?O:null]})]})}function S(e){let{origin:t,session:n}=e;const{0:s,1:r}=(0,i.useState)(""),{0:c,1:l}=(0,i.useState)(),{repo:u,repoId:p,categoryId:h,description:g,backLink:b,term:y,number:f}=(0,i.useContext)(a.E_),C=(0,i.useCallback)((e=>{(0,d.A)({error:e},t)}),[t]),v=(0,i.useCallback)((()=>{(0,d.A)({signOut:!0,error:"State has expired (user signed out)."},t)}),[t]);(0,i.useEffect)((()=>{n&&!s&&async function(e){const t=await fetch("/api/oauth/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session:e})}).then((e=>e.json()));if("error"in t)throw new Error(t.error);const{token:n}=t;if(!n)throw new Error("Unable to retrieve token.");return n}(n).then(r).catch((e=>C(e?.message)))}),[C,n,s]),(0,i.useEffect)((()=>{const e=new ResizeObserver((e=>{const n=e[0];n&&(0,d.A)({resizeHeight:Math.ceil(n.contentRect.height)},t)}));return e.observe(document.querySelector("body")),()=>e.disconnect()}),[t]);return(!n||s)&&u&&(y||f)?(0,o.tZ)(a.Vo.Provider,{value:{token:s,origin:t,getLoginUrl:a.Zd,onSignOut:v},children:(0,o.tZ)(Z,{onDiscussionCreateRequest:async()=>{if(c)return c;const e=async function(e,t){const{id:n}=await fetch("/api/discussions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({repo:e,input:t})}).then((e=>e.json()));return n}(u,{repositoryId:p,categoryId:h,title:y,body:`# ${y}\n\n${g||""}\n\n${(0,m.dd)(b||t)}`});return l(e),e},onError:C})}):null}var I=n(614),R=n.n(I),E=!0;function L(e){let{origin:t,session:n,repo:s,term:d,number:l,category:u,strict:m,repoId:p,categoryId:h,description:g,reactionsEnabled:b,emitMetadata:y,inputPosition:f,defaultCommentOrder:C,theme:v,originHost:N,backLink:w}=e;const x=t||("undefined"===typeof location?"":location.href),{theme:k,setTheme:Z}=(0,i.useContext)(a.Ni),{0:I,1:E}=(0,i.useState)({repo:s,repoId:p,category:u,categoryId:h,description:g,backLink:w,term:d,number:l,strict:m,reactionsEnabled:b,emitMetadata:y,inputPosition:f,defaultCommentOrder:C});return(0,i.useEffect)((()=>{const e=e=>{if(e.origin!==N)return;if("object"!==typeof e.data||!e.data.giscus)return;const t=e.data.giscus;if(!("setConfig"in t))return;const{setConfig:n}=t;"theme"in n&&(Z(n.theme),delete n.theme),R().isReady&&n.lang in c.mT&&(R().replace(R().asPath,R().asPath,{locale:n.lang,scroll:!1}),delete n.lang),E((e=>({...e,...n})))};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)}),[N,Z]),(0,i.useEffect)((()=>Z(v)),[Z,v]),(0,o.BX)(o.HY,{children:[(0,o.BX)(r(),{children:[(0,o.tZ)("base",{target:"_top"}),(0,o.tZ)("title",{children:"giscus"})]}),(0,o.tZ)("main",{className:"w-full mx-auto","data-theme":k,children:(0,o.tZ)(a.E_.Provider,{value:I,children:(0,o.tZ)(S,{origin:x,session:n})})})]})}}},function(e){e.O(0,[9547,7883,4947,9774,2888,179],(function(){return t=4469,e(e.s=t);var t}));var t=e.O();_N_E=t}]);